<!doctype html>
<html lang="zh-CN">
<meta charset="utf-8"/>
<title>整式运算小游戏（简短版）</title>
<style>
body{font-family:Arial;padding:18px;background:#f6f8fb;color:#123}
.box{max-width:720px;margin:auto;background:#fff;padding:16px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
.row{display:flex;gap:8px;align-items:center;margin:8px 0}
.pol{font-family:"Times New Roman",serif;font-size:1.3rem;background:#eef;padding:8px;border-radius:6px}
input,select,button{padding:6px;border-radius:6px;border:1px solid #cfd8e6}
.status{margin-top:8px}
.small{font-size:0.9rem;color:#456}
</style>
<div class="box">
  <h2>整式运算小游戏（简短）</h2>
  <div class="row">
    <label>运算<select id="op"><option value="add">+</option><option value="sub">-</option><option value="mul">×</option></select></label>
    <label>最高次数<select id="deg"><option>1</option><option selected>2</option><option>3</option></select></label>
    <button id="gen">出题</button>
  </div>

  <div class="row">
    <div class="pol" id="q">点击“出题”</div>
  </div>

  <div class="row">
    <input id="ans" placeholder="例如：3x^2-2x+1" style="flex:1"/>
    <button id="sub">提交</button>
    <button id="show">显示答案</button>
  </div>

  <div class="status" id="status"></div>
  <div class="row small">
    <div>得分：<span id="score">0</span></div>
    <div style="margin-left:12px">正确：<span id="ok">0</span></div>
    <div style="margin-left:12px">错误：<span id="bad">0</span></div>
  </div>
  <div class="small" style="margin-top:6px">输入支持示例：<code>3x^2-2x+1</code>、<code>-x^2+4x-5</code> 或常数 <code>5</code></div>
</div>

<script>
// —— 工具：格式化 / 解析 / 运算 —— 
function formatPoly(coeffs){
  let n=coeffs.length-1; while(n>0 && !coeffs[n]) n--;
  let parts=[];
  for(let i=n;i>=0;i--){
    let c=coeffs[i];
    if(!c) continue;
    let sign=(c>0?"+":"-"), a=Math.abs(c);
    let coef=(i===0? a : (a===1? "" : a));
    let varp=(i===0? "" : (i===1? "x" : "x^"+i));
    parts.push((parts.length?sign:""+(sign==="-"? "-" : ""))+coef+varp);
  }
  return parts.length?parts.join(""):"0";
}
function parsePoly(s){
  s=s.replace(/\s+/g,"");
  if(!s) throw "空输入";
  // 将字符串分割成项
  let re=/([+-]?)(\d*)(x?)(?:\^(\d+))?/g, m;
  let coeffs={};
  while((m=re.exec(s))!==null){
    if(m[0]==="") break;
    let sign = m[1]==="-" ? -1 : 1;
    let num = m[2];
    let hasX = m[3]==="x";
    let pow = m[4]? parseInt(m[4],10) : (hasX?1:0);
    let val;
    if(hasX){
      val = (num===""?1:parseInt(num,10)) * sign;
    } else {
      if(num==="") continue;
      val = parseInt((sign===-1? "-":"")+num,10);
    }
    coeffs[pow] = (coeffs[pow]||0) + val;
  }
  // 转成数组
  let max = Math.max(...Object.keys(coeffs).map(k=>+k),0);
  let arr = Array(max+1).fill(0);
  for(let k in coeffs) arr[+k]=coeffs[k];
  return arr;
}
function add(a,b){
  let n=Math.max(a.length,b.length), r=Array(n).fill(0);
  for(let i=0;i<n;i++) r[i]=(a[i]||0)+(b[i]||0);
  return r;
}
function sub(a,b){
  let n=Math.max(a.length,b.length), r=Array(n).fill(0);
  for(let i=0;i<n;i++) r[i]=(a[i]||0)-(b[i]||0);
  return r;
}
function mul(a,b){
  let r=Array((a.length-1)+(b.length-1)+1).fill(0);
  for(let i=0;i<a.length;i++) for(let j=0;j<b.length;j++) r[i+j]+= (a[i]||0)*(b[j]||0);
  return r;
}
function normalize(a){ let n=a.length-1; while(n>0 && !a[n]) n--; return a.slice(0,n+1); }
function eq(a,b){ a=normalize(a); b=normalize(b); let n=Math.max(a.length,b.length); for(let i=0;i<n;i++) if((a[i]||0)!=(b[i]||0)) return false; return true; }

// —— 生成随机多项式（系数小整数）——
function randPoly(maxDeg){
  let deg = Math.floor(Math.random()*(maxDeg+1));
  let a=Array(deg+1).fill(0);
  for(let i=0;i<=deg;i++){
    if(Math.random()<0.6) a[i] = Math.floor(Math.random()*9)-4; // -4..4
  }
  if(a.every(v=>v===0)) return [0];
  if(a[deg]===0) a[deg]= (Math.random()<0.5?1:-1)* (Math.floor(Math.random()*4)+1);
  return normalize(a);
}

// —— 游戏逻辑 —— 
let A,B,ANS;
const el=id=>document.getElementById(id);
el('gen').onclick=()=>{ 
  let op=el('op').value, deg=+el('deg').value;
  A=randPoly(deg); B=randPoly(deg);
  el('q').textContent = formatPoly(A) + " " + (op==='add'?'+':op==='sub'?"-":"×") + " " + formatPoly(B);
  if(op==='add') ANS = normalize(add(A,B));
  if(op==='sub') ANS = normalize(sub(A,B));
  if(op==='mul') ANS = normalize(mul(A,B));
  el('status').textContent=''; el('ans').value='';
};
el('sub').onclick=()=>{
  if(!ANS){ el('status').textContent='请先出题'; return; }
  let s=el('ans').value.trim();
  try{
    let u=parsePoly(s);
    if(eq(u,ANS)){
      el('status').innerHTML = '<span style="color:green">正确！</span> 答案：'+formatPoly(ANS);
      el('score').textContent = +el('score').textContent + 10;
      el('ok').textContent = +el('ok').textContent + 1;
    } else {
      el('status').innerHTML = '<span style="color:red">错误。</span> 正确：'+formatPoly(ANS);
      el('bad').textContent = +el('bad').textContent + 1;
    }
    ANS = null; // 本题结束
  }catch(e){
    el('status').textContent = '解析出错，请按格式输入，例如：3x^2-2x+1';
  }
};
el('show').onclick=()=>{
  if(!ANS){ el('status').textContent='请先出题'; return; }
  el('status').innerHTML = '正确答案：<strong>'+formatPoly(ANS) +'</strong>';
  el('bad').textContent = +el('bad').textContent + 1;
  ANS = null;
};
</script>
</html>